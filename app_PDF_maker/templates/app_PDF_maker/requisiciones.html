{% extends 'app_PDF_maker/base.html' %}

{% block title %}Requisiciones - Dreacht Hub{% endblock %}

{% block extra_head %}
<style>
    body, html {
        margin: 0; padding: 0; height: 100%;;
    }
    #pdf-container {
        position: relative;
        width: 100%;
        height: 100vh;
        overflow: hidden;
    }
    #pdf-canvas {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
    #form-overlay {
        position: absolute;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none; /* disable interaction for now */
    }
</style>
{% endblock %}

{% block content %}
<div id="pdf-container">
    <canvas id="pdf-canvas"></canvas>
    <div id="form-overlay">
        <!-- Form fields will be positioned here absolutely -->
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
<script>
    const url = '/static/media/requiscion_template.pdf'; 

    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.worker.min.js';

    const canvas = document.getElementById('pdf-canvas');
    const ctx = canvas.getContext('2d');

    function renderPDF(url) {
        pdfjsLib.getDocument(url).promise.then(pdf => {
            pdf.getPage(1).then(page => {
                const viewport = page.getViewport({ scale: 1 });
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                page.render(renderContext);
            });
        });
    }

    renderPDF(url);
</script>
{% endblock %}
